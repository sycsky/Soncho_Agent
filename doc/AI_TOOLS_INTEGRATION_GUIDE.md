# AI 工具与结构化数据提取 - 前端集成指南

## 📋 概述

本系统提供两个核心模块：

| 模块 | 用途 | 关系 |
|------|------|------|
| **AI Tools（AI 工具）** | 让 AI 能够调用外部 API 或 MCP 服务 | 每个工具内嵌一个参数 Schema |
| **Extraction Schema（结构化提取）** | 从自然语言中提取结构化数据 | 独立使用，支持多轮对话补全 |

---

## 🔧 模块一：AI Tools（AI 工具）

### 1.1 功能说明

AI 工具允许 AI 模型在对话过程中调用外部服务，例如：
- 查询天气、股票等实时信息
- 发送邮件、短信通知
- 操作数据库、CRM 系统
- 调用 MCP 协议服务

### 1.2 工具类型

| 类型 | 说明 | 配置项 |
|------|------|--------|
| `API` | HTTP REST 接口 | URL、Method、Headers、Body 模板 |
| `MCP` | Model Context Protocol 服务 | Endpoint、工具名、服务器类型 |

### 1.3 数据结构

```typescript
interface AiTool {
  id: string;
  name: string;              // 唯一标识，用于 AI 调用
  displayName: string;       // 显示名称
  description: string;       // 工具描述（帮助 AI 理解用途）
  toolType: 'API' | 'MCP';
  
  // 参数定义（内嵌）
  parameters: ParameterDefinition[];
  
  // API 配置
  apiMethod?: 'GET' | 'POST' | 'PUT' | 'DELETE';
  apiUrl?: string;           // 支持 {{变量}} 占位符
  apiHeaders?: string;       // JSON 格式
  apiBodyTemplate?: string;  // 请求体模板
  apiResponsePath?: string;  // JSONPath 提取响应
  apiTimeout?: number;
  
  // MCP 配置
  mcpEndpoint?: string;
  mcpToolName?: string;
  mcpServerType?: 'stdio' | 'sse' | 'websocket';
  mcpConfig?: string;
  
  // 认证
  authType: 'NONE' | 'API_KEY' | 'BEARER' | 'BASIC' | 'OAUTH2';
  authConfig?: string;       // JSON 格式
  
  // 其他
  inputExample?: string;
  outputExample?: string;
  retryCount: number;
  requireConfirmation: boolean;
  enabled: boolean;
  sortOrder: number;
  tags?: string;
}

interface ParameterDefinition {
  name: string;              // 参数名
  displayName: string;       // 显示名称
  type: FieldType;           // 参数类型
  required: boolean;         // 是否必填
  description: string;       // 参数描述
  enumValues?: string[];     // 枚举值（当 type 为 ENUM）
  defaultValue?: string;     // 默认值
}

type FieldType = 
  | 'STRING' 
  | 'NUMBER' 
  | 'INTEGER' 
  | 'BOOLEAN' 
  | 'DATE' 
  | 'DATETIME' 
  | 'EMAIL' 
  | 'PHONE' 
  | 'ENUM' 
  | 'ARRAY' 
  | 'OBJECT';
```

### 1.4 API 接口

#### 工具管理

```http
# 获取工具列表
GET /api/v1/tools
GET /api/v1/tools?keyword=天气

# 获取工具详情
GET /api/v1/tools/{toolId}

# 创建工具
POST /api/v1/tools
Content-Type: application/json

{
  "name": "get_weather",
  "displayName": "天气查询",
  "description": "查询指定城市的当前天气信息，包括温度、湿度、天气状况",
  "toolType": "API",
  "parameters": [
    {
      "name": "city",
      "displayName": "城市",
      "type": "STRING",
      "required": true,
      "description": "要查询的城市名称，如：北京、上海"
    },
    {
      "name": "units",
      "displayName": "单位",
      "type": "ENUM",
      "required": false,
      "description": "温度单位",
      "enumValues": ["metric", "imperial"],
      "defaultValue": "metric"
    }
  ],
  "apiMethod": "GET",
  "apiUrl": "https://api.weather.com/v1/current?city={{city}}&units={{units}}",
  "apiTimeout": 10,
  "authType": "API_KEY",
  "authConfig": "{\"headerName\": \"X-API-Key\", \"apiKey\": \"your-key\"}"
}

# 更新工具
PUT /api/v1/tools/{toolId}

# 删除工具
DELETE /api/v1/tools/{toolId}
```

#### 工具执行

```http
# 执行工具
POST /api/v1/tools/{toolId}/execute
Content-Type: application/json

{
  "params": {
    "city": "上海",
    "units": "metric"
  },
  "sessionId": "optional-session-id"
}

# 响应
{
  "success": true,
  "output": "{\"temp\": 25, \"condition\": \"晴\"}",
  "errorMessage": null,
  "httpStatus": 200,
  "durationMs": 156,
  "executionId": "exec-uuid"
}
```

#### LLM 集成

```http
# 获取工具定义（用于 Function Calling）
GET /api/v1/tools/definitions

# 获取 OpenAI 格式的 Functions
GET /api/v1/tools/definitions/openai
```

### 1.5 前端 UI 建议

#### 工具列表页

```
┌─────────────────────────────────────────────────────────────┐
│  AI 工具管理                                    [+ 创建工具] │
├─────────────────────────────────────────────────────────────┤
│  🔍 搜索工具...                          [API ▼] [全部状态 ▼]│
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 🌤️ 天气查询                                   [API] │   │
│  │ get_weather                                          │   │
│  │ 查询指定城市的当前天气信息                          │   │
│  │ 参数: city (必填), units                             │   │
│  │ ─────────────────────────────────────────────────── │   │
│  │ ● 已启用    响应: 156ms    成功率: 98.5%            │   │
│  │                              [测试] [编辑] [删除]    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📧 发送邮件                                   [API] │   │
│  │ send_email                                           │   │
│  │ 发送邮件通知给指定收件人                            │   │
│  │ 参数: to (必填), subject (必填), body (必填)        │   │
│  │ ─────────────────────────────────────────────────── │   │
│  │ ○ 已禁用    响应: --      成功率: --                │   │
│  │                              [测试] [编辑] [删除]    │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

#### 工具编辑页

```
┌─────────────────────────────────────────────────────────────┐
│  创建 AI 工具                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  基本信息                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 工具名称 *        [get_weather________________]     │   │
│  │ (用于 AI 调用，只能包含字母、数字、下划线)          │   │
│  │                                                     │   │
│  │ 显示名称          [天气查询___________________]     │   │
│  │                                                     │   │
│  │ 工具描述 *                                          │   │
│  │ ┌─────────────────────────────────────────────┐    │   │
│  │ │ 查询指定城市的当前天气信息，包括温度、     │    │   │
│  │ │ 湿度、天气状况。支持国内外主要城市。       │    │   │
│  │ └─────────────────────────────────────────────┘    │   │
│  │                                                     │   │
│  │ 工具类型 *        (●) API 接口  ( ) MCP 服务        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  参数定义                                      [+ 添加参数] │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ #1 city                                      [删除] │   │
│  │ ┌───────────────────────────────────────────────┐  │   │
│  │ │ 参数名 *   [city____]   显示名 [城市______]   │  │   │
│  │ │ 类型 *     [STRING ▼]   ☑ 必填                │  │   │
│  │ │ 描述       [要查询的城市名称，如：北京______] │  │   │
│  │ └───────────────────────────────────────────────┘  │   │
│  │                                                     │   │
│  │ #2 units                                     [删除] │   │
│  │ ┌───────────────────────────────────────────────┐  │   │
│  │ │ 参数名 *   [units___]   显示名 [单位______]   │  │   │
│  │ │ 类型 *     [ENUM ▼]     ☐ 必填                │  │   │
│  │ │ 枚举值     [metric, imperial________________] │  │   │
│  │ │ 默认值     [metric_________________________] │  │   │
│  │ └───────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  API 配置                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 请求方法 *        [GET ▼]                           │   │
│  │                                                     │   │
│  │ 请求 URL *                                          │   │
│  │ [https://api.weather.com/v1/current?city={{city}}] │   │
│  │ 💡 使用 {{参数名}} 引用参数                         │   │
│  │                                                     │   │
│  │ 请求头 (JSON)                                       │   │
│  │ ┌─────────────────────────────────────────────┐    │   │
│  │ │ {"Content-Type": "application/json"}        │    │   │
│  │ └─────────────────────────────────────────────┘    │   │
│  │                                                     │   │
│  │ 超时时间          [10__] 秒                         │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  认证配置                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 认证方式          [API Key ▼]                       │   │
│  │                                                     │   │
│  │ Header 名称       [X-API-Key__________________]     │   │
│  │ API Key           [************************___]     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  高级选项                                         [展开 ▼] │
│                                                             │
│                               [取消]  [测试连接]  [保存]    │
└─────────────────────────────────────────────────────────────┘
```

#### 工具测试弹窗

```
┌─────────────────────────────────────────────────────────────┐
│  测试工具: 天气查询                                    [×] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  输入参数                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ city *            [上海________________________]    │   │
│  │ units             [metric ▼]                        │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│                                              [执行测试]     │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  执行结果                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ✅ 成功    耗时: 156ms    HTTP: 200                 │   │
│  │ ───────────────────────────────────────────────── │   │
│  │ {                                                   │   │
│  │   "temp": 25,                                       │   │
│  │   "humidity": 65,                                   │   │
│  │   "condition": "晴",                                │   │
│  │   "wind": "东南风 3级"                              │   │
│  │ }                                                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📝 模块二：Extraction Schema（结构化数据提取）

### 2.1 功能说明

结构化数据提取用于从用户的自然语言输入中提取结构化信息，支持：
- 单轮提取：一次性从文本中提取所有字段
- 多轮对话：如果必填字段缺失，自动追问用户

**典型场景**：
- 订单信息收集（商品、数量、地址）
- 用户信息登记（姓名、手机、邮箱）
- 投诉工单创建（问题类型、描述、紧急程度）
- 预约信息填写（日期、时间、服务类型）

### 2.2 数据结构

```typescript
interface ExtractionSchema {
  id: string;
  name: string;                    // Schema 名称
  description: string;             // 用途描述
  fields: FieldDefinition[];       // 字段定义
  llmModelId?: string;             // 使用的 LLM 模型
  createdAt: string;
  updatedAt: string;
}

interface FieldDefinition {
  name: string;                    // 字段名
  displayName: string;             // 显示名称
  type: FieldType;                 // 字段类型
  required: boolean;               // 是否必填
  description: string;             // 字段描述（帮助 AI 理解）
  followupQuestion?: string;       // 追问问题（缺失时询问）
  enumValues?: string[];           // 枚举值
  defaultValue?: string;           // 默认值
}

interface ExtractionSession {
  id: string;
  schemaId: string;
  extractedData: Record<string, any>;   // 已提取的数据
  missingFields: string[];              // 缺失的必填字段
  nextQuestion?: string;                // 下一个追问问题
  status: 'IN_PROGRESS' | 'COMPLETED' | 'CANCELED' | 'FAILED';
  currentRound: number;
  maxRounds: number;
}
```

### 2.3 API 接口

#### Schema 管理

```http
# 获取 Schema 列表
GET /api/v1/extraction/schemas

# 创建 Schema
POST /api/v1/extraction/schemas
Content-Type: application/json

{
  "name": "order_info",
  "description": "订单信息提取",
  "llmModelId": "model-uuid",
  "fields": [
    {
      "name": "productName",
      "displayName": "商品名称",
      "type": "STRING",
      "required": true,
      "description": "用户想要购买的商品名称",
      "followupQuestion": "请问您想购买什么商品？"
    },
    {
      "name": "quantity",
      "displayName": "数量",
      "type": "INTEGER",
      "required": true,
      "description": "购买数量",
      "followupQuestion": "请问您需要多少件？",
      "defaultValue": "1"
    },
    {
      "name": "address",
      "displayName": "收货地址",
      "type": "STRING",
      "required": true,
      "description": "用户的收货地址",
      "followupQuestion": "请问您的收货地址是？"
    },
    {
      "name": "urgency",
      "displayName": "紧急程度",
      "type": "ENUM",
      "required": false,
      "enumValues": ["普通", "加急", "特急"],
      "defaultValue": "普通"
    }
  ]
}

# 更新 Schema
PUT /api/v1/extraction/schemas/{schemaId}

# 删除 Schema
DELETE /api/v1/extraction/schemas/{schemaId}
```

#### 提取会话

```http
# 开始提取会话
POST /api/v1/extraction/sessions/start
Content-Type: application/json

{
  "schemaId": "schema-uuid",
  "initialText": "我想买3个苹果手机",
  "maxRounds": 5
}

# 响应
{
  "sessionId": "session-uuid",
  "extractedData": {
    "productName": "苹果手机",
    "quantity": 3
  },
  "missingFields": ["address"],
  "nextQuestion": "请问您的收货地址是？",
  "status": "IN_PROGRESS",
  "currentRound": 1,
  "completed": false
}

# 继续提取（用户回答追问）
POST /api/v1/extraction/sessions/{sessionId}/continue
Content-Type: application/json

{
  "userText": "北京市朝阳区xxx街道123号"
}

# 响应
{
  "sessionId": "session-uuid",
  "extractedData": {
    "productName": "苹果手机",
    "quantity": 3,
    "address": "北京市朝阳区xxx街道123号",
    "urgency": "普通"
  },
  "missingFields": [],
  "nextQuestion": null,
  "status": "COMPLETED",
  "currentRound": 2,
  "completed": true
}

# 获取会话状态
GET /api/v1/extraction/sessions/{sessionId}

# 取消会话
POST /api/v1/extraction/sessions/{sessionId}/cancel
```

### 2.4 前端 UI 建议

#### Schema 管理页

```
┌─────────────────────────────────────────────────────────────┐
│  结构化数据提取 Schema                         [+ 创建 Schema] │
├─────────────────────────────────────────────────────────────┤
│  🔍 搜索...                                                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📋 订单信息提取                                     │   │
│  │ order_info                                           │   │
│  │ 从用户对话中提取订单相关信息                        │   │
│  │ ─────────────────────────────────────────────────── │   │
│  │ 字段: productName, quantity, address, urgency       │   │
│  │ 必填: 3    可选: 1    模型: gpt-4o-mini             │   │
│  │                                    [测试] [编辑] [删除] │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 📋 用户信息登记                                     │   │
│  │ user_registration                                    │   │
│  │ 收集用户基本信息用于注册                            │   │
│  │ ─────────────────────────────────────────────────── │   │
│  │ 字段: name, phone, email, gender                    │   │
│  │ 必填: 2    可选: 2    模型: gpt-4o-mini             │   │
│  │                                    [测试] [编辑] [删除] │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

#### Schema 编辑页

```
┌─────────────────────────────────────────────────────────────┐
│  创建结构化提取 Schema                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  基本信息                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Schema 名称 *     [order_info_________________]     │   │
│  │                                                     │   │
│  │ 描述              [从用户对话中提取订单信息_____]   │   │
│  │                                                     │   │
│  │ LLM 模型          [gpt-4o-mini ▼]                   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  字段定义                                      [+ 添加字段] │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ #1 productName                          [↑] [↓] [×] │   │
│  │ ┌───────────────────────────────────────────────┐  │   │
│  │ │ 字段名 *   [productName]  显示名 [商品名称__] │  │   │
│  │ │ 类型 *     [STRING ▼]     ☑ 必填              │  │   │
│  │ │ 描述       [用户想要购买的商品名称__________] │  │   │
│  │ │ 追问问题   [请问您想购买什么商品？__________] │  │   │
│  │ └───────────────────────────────────────────────┘  │   │
│  │                                                     │   │
│  │ #2 quantity                             [↑] [↓] [×] │   │
│  │ ┌───────────────────────────────────────────────┐  │   │
│  │ │ 字段名 *   [quantity___]  显示名 [数量______] │  │   │
│  │ │ 类型 *     [INTEGER ▼]    ☑ 必填              │  │   │
│  │ │ 描述       [购买数量________________________] │  │   │
│  │ │ 追问问题   [请问您需要多少件？______________] │  │   │
│  │ │ 默认值     [1______________________________] │  │   │
│  │ └───────────────────────────────────────────────┘  │   │
│  │                                                     │   │
│  │ #3 urgency                              [↑] [↓] [×] │   │
│  │ ┌───────────────────────────────────────────────┐  │   │
│  │ │ 字段名 *   [urgency____]  显示名 [紧急程度__] │  │   │
│  │ │ 类型 *     [ENUM ▼]       ☐ 必填              │  │   │
│  │ │ 枚举值     [普通, 加急, 特急________________] │  │   │
│  │ │ 默认值     [普通___________________________] │  │   │
│  │ └───────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│                                        [取消]  [保存]       │
└─────────────────────────────────────────────────────────────┘
```

#### 提取测试/对话界面

```
┌─────────────────────────────────────────────────────────────┐
│  测试: 订单信息提取                                    [×] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  对话记录                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │  👤 我想买3个苹果手机                               │   │
│  │                                                     │   │
│  │  🤖 好的，我已记录您要购买 3 个苹果手机。           │   │
│  │     请问您的收货地址是？                            │   │
│  │                                                     │   │
│  │  👤 北京市朝阳区xxx街道123号                        │   │
│  │                                                     │   │
│  │  🤖 ✅ 信息收集完成！                               │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  提取结果                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 商品名称    │ 苹果手机                         ✅  │   │
│  │ 数量        │ 3                                ✅  │   │
│  │ 收货地址    │ 北京市朝阳区xxx街道123号         ✅  │   │
│  │ 紧急程度    │ 普通 (默认)                      ✅  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 输入测试文本...                            [发送]   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│                              [重新开始]  [导出 JSON]        │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 两个模块的关系

```
┌─────────────────────────────────────────────────────────────┐
│                        AI 对话流程                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  用户: "帮我查一下北京今天的天气"                          │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    AI 模型分析                       │   │
│  │                                                     │   │
│  │  1. 识别意图: 需要调用工具                          │   │
│  │  2. 选择工具: get_weather                           │   │
│  │  3. 提取参数: city="北京"                           │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              AI Tools 模块执行                      │   │
│  │                                                     │   │
│  │  工具: get_weather                                  │   │
│  │  参数: { city: "北京" }                             │   │
│  │  → 调用 API                                         │   │
│  │  ← 返回: { temp: 25, condition: "晴" }              │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│                           ▼                                 │
│  AI: "北京今天天气晴朗，气温25度"                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    结构化数据收集流程                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  用户: "我想下单买东西"                                     │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │            Extraction Schema 模块                   │   │
│  │                                                     │   │
│  │  Schema: order_info                                 │   │
│  │  已提取: {}                                         │   │
│  │  缺失: productName, quantity, address               │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│                           ▼                                 │
│  AI: "好的，请问您想购买什么商品？"                        │
│                           │                                 │
│  用户: "3个苹果手机，寄到北京朝阳区"                       │
│                           │                                 │
│                           ▼                                 │
│  ┌─────────────────────────────────────────────────────┐   │
│  │            Extraction Schema 模块                   │   │
│  │                                                     │   │
│  │  已提取: {                                          │   │
│  │    productName: "苹果手机",                         │   │
│  │    quantity: 3,                                     │   │
│  │    address: "北京朝阳区"                            │   │
│  │  }                                                  │   │
│  │  缺失: []  ✅ 完成                                  │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                 │
│                           ▼                                 │
│  AI: "好的，您的订单信息已确认..."                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📦 字段类型对照表

| 类型 | 说明 | JSON Schema 类型 | 示例值 |
|------|------|------------------|--------|
| `STRING` | 字符串 | string | "苹果手机" |
| `NUMBER` | 数字（含小数） | number | 99.99 |
| `INTEGER` | 整数 | integer | 3 |
| `BOOLEAN` | 布尔值 | boolean | true |
| `DATE` | 日期 | string (date) | "2024-01-15" |
| `DATETIME` | 日期时间 | string (date-time) | "2024-01-15T10:30:00" |
| `EMAIL` | 邮箱 | string (email) | "user@example.com" |
| `PHONE` | 电话 | string | "13800138000" |
| `ENUM` | 枚举 | string (enum) | "普通" |
| `ARRAY` | 数组 | array | ["A", "B"] |
| `OBJECT` | 对象 | object | {"key": "value"} |

---

## 🔐 认证类型说明

| 类型 | 配置示例 | 说明 |
|------|----------|------|
| `NONE` | - | 无认证 |
| `API_KEY` | `{"headerName": "X-API-Key", "apiKey": "xxx"}` | API Key 认证 |
| `BEARER` | `{"token": "xxx"}` | Bearer Token |
| `BASIC` | `{"username": "user", "password": "pass"}` | Basic Auth |
| `OAUTH2` | `{"accessToken": "xxx"}` | OAuth2 Token |

---

## 💡 最佳实践

### 工具设计
1. **名称规范**：使用小写字母和下划线，如 `get_weather`、`send_email`
2. **描述清晰**：详细描述工具用途，帮助 AI 正确选择
3. **参数简洁**：只定义必要参数，避免过多可选项
4. **错误处理**：设置合理的超时和重试次数

### 提取 Schema 设计
1. **字段精简**：只定义需要的字段
2. **追问友好**：followupQuestion 要自然、礼貌
3. **默认值合理**：为非必填字段设置合理默认值
4. **类型准确**：选择正确的字段类型便于后续处理

